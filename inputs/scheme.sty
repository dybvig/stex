\usepackage{color}
\def\transerr#1{\begingroup\slshape}
\def\transin#1{\begingroup\color{red}}
\def\transout#1{\begingroup\color{blue}}
\def\traceout#1{\begingroup\color{blue}}
\def\endtranserr#1{\endgroup}
\def\endtransin#1{\endgroup}
\def\endtransout#1{\endgroup}
\def\endtraceout#1{\endgroup}

% this didn't work --- screwed up indentation:
\long\def\showinteraction#1#2{\begin{minipage}[t]{4.375in}#1\end{minipage}\hfill\fbox{\begin{minipage}[t]{2in}#2\end{minipage}}}
% so I resorted to this:
\def\startrepl{\begin{minipage}[t]{4.3in}} % was 4.375 and 2 when interactionwindow = 28
\def\endrepl{\end{minipage}}
\def\startinteraction{\begin{minipage}[t]{2.2in}\vrule\begin{minipage}[t]{2.2in}\hrule\schemeindent=2pt}
\def\endinteraction{\hrule\end{minipage}\vrule\end{minipage}}

\newskip\ttglue
\ttglue=.5em plus .25em minus .15em
\newskip\schemeindent
\schemeindent=0pt
{\obeyspaces\global\let =\ }
\def\schtilde{\raisebox{-.5ex}{\hbox{\char`\~}}}
\def\schdot{.}
\def\schcarat{\char`\^}
\def\schbackslash{\char`\\}
\def\schatsign{\char`\@}
\def\schunderscore{\char`\_}
\def\schlbrace{\char`\{}
\def\schrbrace{\char`\}}
\def\scheme#1{\mbox{\ttfamily\frenchspacing\spaceskip=\ttglue#1}}

\def\schemeblankline{\par\penalty-100\vskip .7\baselineskip}
\def\schemelinestart{{\leavevmode\hbox{\hskip \schemeindent\relax}}}
%%% handle numbered lines in scheme.sty and scheme.hsty
%%% ---have scheme-prep produce only \schemelinestart
\def\schemelinestartnumbered#1{{\leavevmode\hbox{\hbox to 1em {\hfil{\rm #1}} \hskip .5\schemeindent\relax}}}

\def\noskip\schemedisplay{\begingroup%
  \parindent=0pt%
  \parskip=0pt%
  \def\becomes{\hbox to 2em{\hfil$\rightarrow$\hfil}}%
  \def\is{\hbox to 2em{\hfil$\Rightarrow$\hfil}}%
  \def\si{\hbox to 2em{\hfil}}%
  \interlinepenalty=2000%
  \tt\obeyspaces\frenchspacing}
\def\schemedisplay{\beforeschemedisplay\noskip\schemedisplay}
\def\longcode\schemedisplay{\penalty-200\vskip 8pt plus 4pt%
  \kern3pt\hrule\kern5pt\nobreak\noskip\schemedisplay}
\def\endschemedisplay{\par\endgroup\afterschemedisplay}
\def\var#1{{\normalsize\textrm{\textit{#1}}}}
\def\raw#1{#1}
\def\beforeschemedisplay{\penalty-100\vskip\parskip\vskip5pt}
\def\afterschemedisplay{\penalty-200\vskip5pt}

% From test/screenshotter/test.tex in the KaTeX source code, which says:
% > Based on LaTeX's definition of \LaTeX, with L changed to K and kerns
% > changed as in src/macros.js
\DeclareRobustCommand{\KaTeX}{\mbox{%
K\kern-.17em%
{\sbox0 T\vbox to\ht0{\hbox%
  {\fontsize{.75em}{1em}\selectfont A}%
\vss}}%
\kern-.15em%
\TeX}}
